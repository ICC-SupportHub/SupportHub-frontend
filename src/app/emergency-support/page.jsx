"use client"
import Link from "next/link"
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { Badge } from "@/components/ui/badge"
import {
  PhoneIcon,
  MessageSquareIcon,
  ExternalLinkIcon,
  AlertTriangleIcon,
  UsersIcon,
  HeartIcon,
  HelpCircleIcon,
  RefreshCwIcon,
} from "lucide-react"
import { useEffect, useState, useRef } from "react"
import EmergencyFlowchart from "@/app/emergency-support/components/emergency-flowchart"
import FAQSection from "@/app/emergency-support/components/faq-section"
import SpecializedServices from "@/app/emergency-support/components/specialized-services"
import BreathingExercise from "@/app/emergency-support/components/breathing-exercise"
import RegionalServices from "@/app/emergency-support/components/regional-services"

const EmergencyPage = () => {
  const [animalStates, setAnimalStates] = useState({
    cat: { showImage: false, imageUrl: "", loading: false },
    dog: { showImage: false, imageUrl: "", loading: false },
  })
  const [isVisible, setIsVisible] = useState(false)
  const [breathingOpen, setBreathingOpen] = useState(false)
  const [activeTab, setActiveTab] = useState("emergency")
  const [indicatorStyle, setIndicatorStyle] = useState({ width: 0, left: 0 })
  const tabRefs = useRef({})

  const emergencyContacts = [
    {
      name: "Ï≤≠ÏÜåÎÖÑÏ†ÑÌôî 1388",
      number: "1388",
      description: "Ï≤≠ÏÜåÎÖÑ Í¥ÄÎ†® Í≥†ÎØº/ÎèÑÏõÄ 365Ïùº 24ÏãúÍ∞Ñ. Î¨∏Ïûê(#1388)\nÏπ¥Ïπ¥Ïò§ÌÜ°(#1388)ÎèÑ Í∞ÄÎä•",
      type: "Ï†ÑÌôî",
    },
    {
      name: "Ï≤≠ÏÜåÎÖÑ ÏÇ¨Ïù¥Î≤ÑÏÉÅÎã¥ÏÑºÌÑ∞",
      number: "www.cyber1388.kr",
      description: "ÏùµÎ™Ö Ï±ÑÌåÖ ÏÉÅÎã¥ Í∞ÄÎä• (24ÏãúÍ∞Ñ)",
      type: "Ïò®ÎùºÏù∏",
    },
    {
      name: "Ï†ïÏã†Í±¥Í∞ï ÏÉÅÎã¥Ï†ÑÌôî",
      number: "1577-0199",
      description: "Ï†ïÏã† Í±¥Í∞ï Î∞è ÏúÑÍ∏∞ ÏÉÅÎã¥ 24ÏãúÍ∞Ñ (Ï†ÑÍµ≠, ÏßÄÏó≠Î≤àÌò∏ ÏóÜÏù¥)",
      type: "Ï†ÑÌôî",
    },
    {
      name: "Î≥¥Í±¥Î≥µÏßÄÏÉÅÎã¥ÏÑºÌÑ∞",
      number: "129",
      description: "Í∏¥Í∏âÎ≥µÏßÄ, Î≥µÏßÄÏÇ¨Í∞ÅÏßÄÎåÄ, ÌïôÎåÄ Í¥ÄÎ†® ÏÉÅÎã¥ 24ÏãúÍ∞Ñ",
      type: "Ï†ÑÌôî",
    },
    {
      name: "ÏûêÏÇ¥ÏòàÎ∞© ÏÉÅÎã¥Ï†ÑÌôî",
      number: "109",
      description: "ÏûêÏÇ¥ Í¥ÄÎ†® ÏÉÅÎã¥ 24ÏãúÍ∞Ñ",
      type: "Ï†ÑÌôî",
    },
    {
      name: "ÏÉùÎ™ÖÏùòÏ†ÑÌôî",
      number: "1588-9191",
      description: "ÏûêÏÇ¥ ÏòàÎ∞© ÏÉÅÎã¥ 24ÏãúÍ∞Ñ",
      type: "Ï†ÑÌôî",
    },
  ]

  const selfCareResources = [
    {
      title: "Ìò∏Ìù° Ïö¥Îèô",
      description: "4-7-8 Ìò∏Ìù°Î≤ïÏúºÎ°ú ÎßàÏùåÏùÑ ÏßÑÏ†ïÏãúÏºúÎ≥¥ÏÑ∏Ïöî",
      action: "ÏßÄÍ∏à ÏãúÏûëÌïòÍ∏∞",
      detail: "4Ï¥à ÎèôÏïà Ïà®ÏùÑ Îì§Ïù¥ÎßàÏãúÍ≥†, 7Ï¥à ÎèôÏïà Ï∞∏ÏùÄ ÌõÑ, 8Ï¥à ÎèôÏïà Ï≤úÏ≤úÌûà ÎÇ¥Ïâ¨ÏÑ∏Ïöî. Ïù¥Î•º 4Ìöå Î∞òÎ≥µÌï©ÎãàÎã§.",
      type: "breath",
    },
    {
      title: "Í∏çÏ†ïÏ†Å ÏÉùÍ∞Å",
      description: "ÏßÄÍ∏à Ïù¥ ÏàúÍ∞Ñ Í∞êÏÇ¨Ìïú Í≤É 3Í∞ÄÏßÄÎ•º Îñ†Ïò¨Î†§Î≥¥ÏÑ∏Ïöî",
      action: "ÏÉùÍ∞ÅÌï¥Î≥¥Í∏∞",
      detail: "ÏûëÏùÄ Í≤ÉÏù¥ÎùºÎèÑ Ï¢ãÏäµÎãàÎã§. Îî∞ÎúªÌïú Ï∞® Ìïú Ïûî, Ìé∏ÏïàÌïú Ïπ®ÎåÄ, ÎÇòÎ•º Í±±Ï†ïÌï¥Ï£ºÎäî ÏÇ¨Îûå Îì±ÏùÑ Îñ†Ïò¨Î†§Î≥¥ÏÑ∏Ïöî.",
    },
    {
      title: "ÏïàÏ†ÑÌïú Ïû•ÏÜå",
      description: "Ïã†Î¢∞Ìï† Ïàò ÏûàÎäî ÏÇ¨ÎûåÏóêÍ≤å Ïó∞ÎùΩÌïòÍ±∞ÎÇò ÏïàÏ†ÑÌïú Í≥≥ÏúºÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî",
      action: "ÎèÑÏõÄ ÏöîÏ≤≠ÌïòÍ∏∞",
      detail: "Í∞ÄÏ°±, ÏπúÍµ¨, ÎèôÎ£å Ï§ë ÎØøÏùÑ Ïàò ÏûàÎäî ÏÇ¨ÎûåÏóêÍ≤å Ïó∞ÎùΩÌïòÍ±∞ÎÇò, Í≥µÍ≥µÏû•ÏÜåÎÇò Î≥ëÏõê Îì± ÏïàÏ†ÑÌïú Í≥≥ÏúºÎ°ú Ïù¥ÎèôÌïòÏÑ∏Ïöî.",
    },
    {
      title: "üê± Í∑ÄÏó¨Ïö¥ Í≥†ÏñëÏù¥ Î≥¥Í∏∞",
      description: "ÏÇ¨ÎûëÏä§Îü¨Ïö¥ Í≥†ÏñëÏù¥ ÏÇ¨ÏßÑÏúºÎ°ú ÎßàÏùåÏùÑ Îã¨ÎûòÎ≥¥ÏÑ∏Ïöî",
      action: "Í≥†ÏñëÏù¥ Î≥¥Í∏∞",
      detail: "ÎûúÎç§Ìïú Í≥†ÏñëÏù¥ ÏÇ¨ÏßÑÏúºÎ°ú ÎßàÏùåÏùÑ Ìé∏ÏïàÌïòÍ≤å Ìï¥Î≥¥ÏÑ∏Ïöî!",
      type: "cat",
    },
    {
      title: "üê∂ Í∑ÄÏó¨Ïö¥ Í∞ïÏïÑÏßÄ Î≥¥Í∏∞",
      description: "ÏÇ¨ÎûëÏä§Îü¨Ïö¥ Í∞ïÏïÑÏßÄ ÏÇ¨ÏßÑÏúºÎ°ú ÎßàÏùåÏùÑ Îî∞ÎúªÌïòÍ≤å ÌïòÏÑ∏Ïöî",
      action: "Í∞ïÏïÑÏßÄ Î≥¥Í∏∞",
      detail: "ÎûúÎç§Ìïú Í∞ïÏïÑÏßÄ ÏÇ¨ÏßÑÏúºÎ°ú ÎßàÏùåÏùÑ Îî∞ÎúªÌïòÍ≤å Ìï¥Î≥¥ÏÑ∏Ïöî!",
      type: "dog",
    },
    {
      title: "5-4-3-2-1 Í∏∞Î≤ï",
      description: "ÌòÑÏû¨ ÏàúÍ∞ÑÏóê ÏßëÏ§ëÌïòÏó¨ Î∂àÏïàÍ∞êÏùÑ Ï§ÑÏó¨Î≥¥ÏÑ∏Ïöî",
      action: "ÏãúÏûëÌïòÍ∏∞",
      detail: "Î≥¥Ïù¥Îäî Í≤É 5Í∞ú, ÎßåÏßà Ïàò ÏûàÎäî Í≤É 4Í∞ú, Îì§Î¶¨Îäî Í≤É 3Í∞ú, ÎÉÑÏÉàÎÇòÎäî Í≤É 2Í∞ú, ÎßõÎ≥¥Îäî Í≤É 1Í∞úÎ•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî.",
    },
    {
      title: "Îî∞ÎúªÌïú ÏÉ§Ïõå",
      description: "Îî∞ÎúªÌïú Î¨ºÎ°ú Î™∏Í≥º ÎßàÏùåÏùÑ Ïù¥ÏôÑÏãúÏºúÎ≥¥ÏÑ∏Ïöî",
      action: "ÏãúÎèÑÌï¥Î≥¥Í∏∞",
      detail: "Îî∞ÎúªÌïú Î¨ºÏùò Ïò®ÎèÑÏôÄ Í∞êÏ¥âÏóê ÏßëÏ§ëÌïòÎ©∞ Í∏¥Ïû•ÏùÑ ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî. 10-15Î∂Ñ Ï†ïÎèÑÍ∞Ä Ï†ÅÎãπÌï©ÎãàÎã§.",
    },
    {
      title: "ÏùåÏïÖ Îì£Í∏∞",
      description: "Ï¢ãÏïÑÌïòÎäî ÏùåÏïÖÏù¥ÎÇò ÏûêÏó∞ ÏÜåÎ¶¨Î•º Îì§Ïñ¥Î≥¥ÏÑ∏Ïöî",
      action: "ÏùåÏïÖ Ïû¨ÏÉù",
      detail: "ÌÅ¥ÎûòÏãù, ÏûêÏó∞ ÏÜåÎ¶¨, Ï¢ãÏïÑÌïòÎäî ÎÖ∏Îûò Îì± ÎßàÏùåÏùÑ Ìé∏ÏïàÌïòÍ≤å Ìï¥Ï£ºÎäî ÏùåÏïÖÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.",
    },
  ]

  // Í≥†ÏñëÏù¥ Ïù¥ÎØ∏ÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
  const fetchCatImage = async (apiType) => {
    setAnimalStates((prev) => ({
      ...prev,
      cat: { ...prev.cat, loading: true, selectedApi: apiType },
    }))

    try {
      const timestamp = Date.now()
      let catUrl = ""

      switch (apiType) {
        case "cataas":
          catUrl = `https://cataas.com/cat?${timestamp}`
          break
        case "thecat":
          try {
            const response = await fetch("https://api.thecatapi.com/v1/images/search")
            if (!response.ok) throw new Error(`HTTP ${response.status}`)
            const data = await response.json()
            if (data && data[0] && data[0].url) {
              catUrl = data[0].url
            } else {
              throw new Error("The Cat API ÏùëÎãµ Ïò§Î•ò")
            }
          } catch (error) {
            catUrl = `https://cataas.com/cat?${timestamp}`
          }
          break
        case "randomcat":
          try {
            const response = await fetch(`https://api.thecatapi.com/v1/images/search?limit=1&${timestamp}`)
            if (!response.ok) throw new Error(`HTTP ${response.status}`)
            const data = await response.json()
            if (data && data[0] && data[0].url) {
              catUrl = data[0].url
            } else {
              throw new Error("Random Cat API ÏùëÎãµ Ïò§Î•ò")
            }
          } catch (error) {
            catUrl = `https://cataas.com/cat?${timestamp}`
          }
          break
        default:
          catUrl = `https://cataas.com/cat?${timestamp}`
      }

      if (catUrl.startsWith("http")) {
        const img = new Image()
        img.crossOrigin = "anonymous"

        img.onload = () => {
          setAnimalStates((prev) => ({
            ...prev,
            cat: { showImage: true, imageUrl: catUrl, loading: false, selectedApi: apiType },
          }))
        }

        img.onerror = () => {
          setAnimalStates((prev) => ({
            ...prev,
            cat: {
              showImage: true,
              imageUrl: `https://cataas.com/cat?${Date.now()}`,
              loading: false,
              selectedApi: apiType,
            },
          }))
        }

        img.src = catUrl
      } else {
        setAnimalStates((prev) => ({
          ...prev,
          cat: { showImage: true, imageUrl: catUrl, loading: false, selectedApi: apiType },
        }))
      }
    } catch (error) {
      setAnimalStates((prev) => ({
        ...prev,
        cat: {
          showImage: true,
          imageUrl: `https://cataas.com/cat?${Date.now()}`,
          loading: false,
          selectedApi: apiType,
        },
      }))
    }
  }

  // Í∞ïÏïÑÏßÄ Ïù¥ÎØ∏ÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
  const fetchDogImage = async (apiType) => {
    setAnimalStates((prev) => ({
      ...prev,
      dog: { ...prev.dog, loading: true, selectedApi: apiType },
    }))

    try {
      let dogUrl = ""

      switch (apiType) {
        case "dogceo":
          try {
            const response = await fetch("https://dog.ceo/api/breeds/image/random")
            if (!response.ok) throw new Error(`HTTP ${response.status}`)
            const data = await response.json()
            if (data && data.status === "success" && data.message) {
              dogUrl = data.message
            } else {
              throw new Error("Dog CEO API ÏùëÎãµ Ïò§Î•ò")
            }
          } catch (error) {
            throw error
          }
          break

        case "dogfacts":
          try {
            const response = await fetch("https://some-random-api.com/animal/dog")
            if (!response.ok) throw new Error(`HTTP ${response.status}`)
            const data = await response.json()
            if (data && data.image) {
              dogUrl = data.image
            } else {
              throw new Error("Dog Facts API ÏùëÎãµ Ïò§Î•ò")
            }
          } catch (error) {
            const fallbackResponse = await fetch("https://dog.ceo/api/breeds/image/random")
            const fallbackData = await fallbackResponse.json()
            dogUrl = fallbackData.message
          }
          break

        case "shibe":
          try {
            const response = await fetch("https://shibe.online/api/shibes?count=1&urls=true&httpsUrls=true")
            if (!response.ok) throw new Error(`HTTP ${response.status}`)
            const data = await response.json()
            if (data && Array.isArray(data) && data.length > 0) {
              dogUrl = data[0]
            } else {
              throw new Error("Shibe API ÏùëÎãµ Ïò§Î•ò")
            }
          } catch (error) {
            const fallbackResponse = await fetch("https://dog.ceo/api/breeds/image/random")
            const fallbackData = await fallbackResponse.json()
            dogUrl = fallbackData.message
          }
          break

        case "randomdog":
          try {
            const apiOptions = [
              {
                url: "https://random.dog/woof.json",
                handler: async (response) => {
                  const data = await response.json()
                  if (data && data.url && !data.url.includes(".mp4") && !data.url.includes(".webm")) {
                    return data.url
                  }
                  throw new Error("ÎπÑÎîîÏò§ ÌååÏùºÏù¥Í±∞ÎÇò ÏùëÎãµ Ïò§Î•ò")
                },
              },
              {
                url: "https://dog-api.kinduff.com/api/facts",
                handler: async (response) => {
                  throw new Error("Facts APIÎäî Ïù¥ÎØ∏ÏßÄ ÎØ∏Ï†úÍ≥µ")
                },
              },
              {
                url: "https://api.woofbot.io/v1/woof",
                handler: async (response) => {
                  const data = await response.json()
                  if (data && data.image) {
                    return data.image
                  }
                  throw new Error("WoofBot API ÏùëÎãµ Ïò§Î•ò")
                },
              },
            ]

            let success = false
            for (const option of apiOptions) {
              try {
                const response = await fetch(option.url)
                if (!response.ok) continue
                dogUrl = await option.handler(response)
                success = true
                break
              } catch (optionError) {
                continue
              }
            }

            if (!success) {
              throw new Error("Î™®Îì† Random Dog API ÏòµÏÖò Ïã§Ìå®")
            }
          } catch (error) {
            const fallbackResponse = await fetch("https://dog.ceo/api/breeds/image/random")
            const fallbackData = await fallbackResponse.json()
            dogUrl = fallbackData.message
          }
          break

        default:
          const response = await fetch("https://dog.ceo/api/breeds/image/random")
          const data = await response.json()
          dogUrl = data.message
      }

      setAnimalStates((prev) => ({
        ...prev,
        dog: { showImage: true, imageUrl: dogUrl, loading: false, selectedApi: apiType },
      }))
    } catch (error) {
      try {
        const fallbackResponse = await fetch("https://dog.ceo/api/breeds/image/random")
        if (fallbackResponse.ok) {
          const fallbackData = await fallbackResponse.json()
          setAnimalStates((prev) => ({
            ...prev,
            dog: {
              showImage: true,
              imageUrl: fallbackData.message || "/placeholder.svg?height=300&width=400&text=üê∂ Í∞ïÏïÑÏßÄ Î°úÎìú Ïã§Ìå®",
              loading: false,
              selectedApi: apiType,
            },
          }))
        } else {
          throw new Error("ÏµúÏ¢Ö fallbackÎèÑ Ïã§Ìå®")
        }
      } catch (finalError) {
        setAnimalStates((prev) => ({
          ...prev,
          dog: {
            showImage: true,
            imageUrl: "/placeholder.svg?height=300&width=400&text=üê∂ Î™®Îì† API Ïã§Ìå®",
            loading: false,
            selectedApi: apiType,
          },
        }))
      }
    }
  }

  const tabs = [
    { id: "emergency", name: "Í∏¥Í∏â ÏÉÅÌô©", icon: AlertTriangleIcon },
    { id: "professional", name: "Ï†ÑÎ¨∏ ÏÉÅÎã¥", icon: UsersIcon },
    { id: "selfcare", name: "ÏûêÍ∞Ä Í¥ÄÎ¶¨", icon: HeartIcon },
    { id: "help", name: "ÎèÑÏõÄÎßê", icon: HelpCircleIcon },
  ]

  useEffect(() => {
    setIsVisible(true)
  }, [])

  useEffect(() => {
    const activeTabElement = tabRefs.current[activeTab]
    if (activeTabElement) {
      const { offsetWidth, offsetLeft } = activeTabElement
      setIndicatorStyle({
        width: offsetWidth,
        left: offsetLeft,
      })
    }
  }, [activeTab])

  const handleCall = (number) => {
    if (number.startsWith("www")) {
      window.open(`https://${number}`, "_blank")
    } else {
      window.open(`tel:${number}`)
    }
  }

  return (
    <div className="relative flex flex-col items-center min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-red-50 dark:from-slate-900 dark:via-red-900 dark:to-pink-900 p-4 overflow-auto">
      {/* Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ */}
      <div className="absolute inset-0 opacity-20 dark:opacity-10">
        <div
          className="w-full h-full bg-cover bg-center bg-no-repeat"
          style={{
            backgroundImage: `url('/placeholder.svg?height=1080&width=1920')`,
          }}
        />
      </div>

      {/* Î∂ÄÎìúÎü¨Ïö¥ Ïò§Î≤ÑÎ†àÏù¥ */}
      <div className="absolute inset-0 bg-gradient-to-b from-white/30 via-transparent to-white/20 dark:from-slate-900/50 dark:via-transparent dark:to-slate-900/30" />

      <div
        className={`relative z-10 w-full max-w-5xl mx-auto space-y-6 transition-all duration-1000 ease-out ${
          isVisible ? "opacity-100 translate-y-0" : "opacity-0 translate-y-8"
        }`}
      >
        {/* Ìó§Îçî */}
        <Card className="shadow-lg rounded-lg">
          <CardHeader className="bg-gradient-to-r from-red-500 via-rose-500 to-pink-500 text-white rounded-t-lg p-6 shadow-lg">
            <CardTitle className="text-3xl font-bold text-center flex items-center justify-center gap-2">
              <AlertTriangleIcon className="h-8 w-8" aria-hidden="true" />
              Í∏¥Í∏â Ïã¨Î¶¨ÏßÄÏõê
            </CardTitle>
            <p className="text-center text-red-100 mt-2">
              ÏúÑÍ∏∞ ÏÉÅÌô©ÏóêÏÑú Ï¶âÏãú ÎèÑÏõÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Ïó∞ÎùΩÏ≤òÏôÄ ÏûêÍ∞Ä Í¥ÄÎ¶¨ Î∞©Î≤ïÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§
            </p>
          </CardHeader>
        </Card>

        {/* ÏùëÍ∏âÏÉÅÌô© ÏïåÎ¶º (ÏïÑÏù¥ÏΩòÏùÑ Î¨∏Ïû•Í≥º Í∞ôÏùÄ Ï§ÑÏóê ÌëúÏãú) */}
        <Alert className="border-red-200 bg-red-50/80 dark:bg-red-950/50 backdrop-blur-sm shadow-sm">
          <AlertDescription className="flex items-center gap-2 text-red-800 dark:text-red-200 m-0">
            <AlertTriangleIcon className="h-5 w-5 text-red-600 shrink-0" aria-hidden="true" />
            <span>
              <strong>ÏùëÍ∏âÏÉÅÌô© Ïãú:</strong> ÏÉùÎ™ÖÏù¥ ÏúÑÌóòÌïòÎã§Í≥† ÎäêÎÅºÏãúÎ©¥ Ï¶âÏãú 119Ïóê Ïã†Í≥†ÌïòÍ±∞ÎÇò Í∞ÄÍπåÏö¥ ÏùëÍ∏âÏã§Î°ú Í∞ÄÏÑ∏Ïöî.
            </span>
          </AlertDescription>
        </Alert>

        {/* ÌÉ≠ Î©îÎâ¥ */}
        <Card className="shadow-lg backdrop-blur-sm bg-white/80 dark:bg-slate-800/80 border-0 overflow-hidden">
          {/* ÌòÑÎåÄÏ†ÅÏù∏ Ïõπ Ïä§ÌÉÄÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
          <div className="border-b border-gray-200 dark:border-gray-700 relative">
            <nav className="flex -mb-px relative" aria-label="Tabs">
              {tabs.map((tab) => (
                <button
                  key={tab.id}
                  ref={(el) => (tabRefs.current[tab.id] = el)}
                  onClick={() => setActiveTab(tab.id)}
                  className={`group relative min-w-0 flex-1 overflow-hidden py-4 px-4 text-center text-sm font-medium focus:z-10 focus:outline-none transition-all duration-200 ${
                    activeTab === tab.id
                      ? "text-red-600 dark:text-red-400"
                      : "text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
                  }`}
                  aria-current={activeTab === tab.id ? "page" : undefined}
                >
                  <div className="flex items-center justify-center gap-2">
                    <tab.icon
                      className={`h-5 w-5 transition-colors duration-200 ${
                        activeTab === tab.id
                          ? "text-red-600 dark:text-red-400"
                          : "text-gray-400 group-hover:text-gray-500"
                      }`}
                      aria-hidden="true"
                    />
                    <span className="transition-colors duration-200">{tab.name}</span>
                  </div>
                </button>
              ))}

              {/* Ïä¨ÎùºÏù¥Îî© Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ */}
              <div
                className="absolute bottom-0 h-0.5 bg-gradient-to-r from-red-500 to-rose-500 transition-all duration-300 ease-out"
                style={{
                  width: `${indicatorStyle.width}px`,
                  transform: `translateX(${indicatorStyle.left}px)`,
                }}
              />
            </nav>
          </div>

          {/* ÌÉ≠ ÏΩòÌÖêÏ∏† */}
          <div className="p-6">
            {/* Í∏¥Í∏â ÏÉÅÌô© ÌÉ≠ */}
            {activeTab === "emergency" && (
              <div className="space-y-6 animate-fadeIn">
                <EmergencyFlowchart />

                <Card className="shadow-md backdrop-blur-sm bg-white/60 dark:bg-slate-800/60 border-0">
                  <CardHeader>
                    <CardTitle className="text-xl font-bold text-gray-800 dark:text-gray-200">
                      24ÏãúÍ∞Ñ ÏÉÅÎã¥ Ïó∞ÎùΩÏ≤ò
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {emergencyContacts.map((contact, index) => (
                      <div
                        key={index}
                        className="flex items-center justify-between p-4 border border-slate-200/50 dark:border-slate-600/50 rounded-lg hover:bg-gradient-to-r hover:from-rose-50/50 hover:to-pink-50/50 dark:hover:from-slate-700/50 dark:hover:to-slate-600/50 transition-all duration-300 ease-in-out transform hover:scale-[1.02] hover:shadow-md"
                      >
                        <div className="flex-1">
                          <h3 className="font-semibold text-lg text-gray-800 dark:text-gray-200">{contact.name}</h3>
                          <p className="text-gray-600 dark:text-gray-400 whitespace-pre-line">{contact.description}</p>
                          <p className="text-sm text-purple-600 font-mono">{contact.number}</p>
                        </div>
                        <Button
                          onClick={() => handleCall(contact.number)}
                          className="bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105"
                        >
                          {contact.type === "Ï†ÑÌôî" ? (
                            <PhoneIcon className="mr-2 h-4 w-4" aria-hidden="true" />
                          ) : (
                            <ExternalLinkIcon className="mr-2 h-4 w-4" aria-hidden="true" />
                          )}
                          {contact.type === "Ï†ÑÌôî" ? "Ï†ÑÌôîÌïòÍ∏∞" : "Ï†ëÏÜçÌïòÍ∏∞"}
                        </Button>
                      </div>
                    ))}
                  </CardContent>
                </Card>
              </div>
            )}

            {/* Ï†ÑÎ¨∏ ÏÉÅÎã¥ ÌÉ≠ */}
            {activeTab === "professional" && (
              <div className="space-y-6 animate-fadeIn">
                <SpecializedServices />
                <RegionalServices />
              </div>
            )}

            {/* ÏûêÍ∞Ä Í¥ÄÎ¶¨ ÌÉ≠ */}
            {activeTab === "selfcare" && (
              <div className="space-y-6 animate-fadeIn">
                <Card className="shadow-md backdrop-blur-sm bg-white/60 dark:bg-slate-800/60 border-0">
                  <CardHeader>
                    <CardTitle className="text-xl font-bold text-gray-800 dark:text-gray-200">
                      Ï¶âÏãú Ìï† Ïàò ÏûàÎäî ÏûêÍ∞Ä Í¥ÄÎ¶¨
                    </CardTitle>
                    <p className="text-sm text-gray-600 dark:text-gray-400">
                      ÌòºÏûêÏÑúÎèÑ Ìï† Ïàò ÏûàÎäî ÎßàÏùå ÎèåÎ¥Ñ Î∞©Î≤ïÎì§ÏùÑ ÏïàÎÇ¥Ìï¥ÎìúÎ¶ΩÎãàÎã§.
                    </p>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {selfCareResources.map((resource, index) => (
                      <div
                        key={index}
                        className={`p-4 border border-slate-200/50 dark:border-slate-600/50 rounded-lg transition-all duration-300 ease-in-out transform hover:scale-[1.02] hover:shadow-md hover:bg-gradient-to-r hover:from-red-50/50 hover:to-rose-50/50 dark:hover:from-slate-700/50 dark:hover:to-slate-600/50 ${
                          resource.type === "breath" && breathingOpen
                            ? "bg-gradient-to-r from-red-50/60 to-rose-50/60 dark:from-slate-700/60 dark:to-slate-600/60 ring-1 ring-rose-200/50"
                            : ""
                        }`}
                      >
                        <div className="flex items-start justify-between mb-3">
                          <div className="flex-1">
                            <h3 className="font-semibold text-lg text-gray-800 dark:text-gray-200 mb-2">
                              {resource.title}
                            </h3>
                            <p className="text-gray-600 dark:text-gray-400 mb-2">{resource.description}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">{resource.detail}</p>
                          </div>
                          {!resource.apis && (
                              <Button
                              onClick={() => {
                                    if (resource.type === "breath") {
                                      setBreathingOpen((v) => !v)
                                    } else if (resource.type === "cat") {
                                  fetchCatImage("randomcat")
                                } else if (resource.type === "dog") {
                                  fetchDogImage("randomdog")
                                }
                              }}
                              disabled={resource.type && animalStates[resource.type]?.loading}
                              variant="outline"
                              className="border-red-300 text-red-600 hover:bg-gradient-to-r hover:from-red-50 hover:to-rose-50 bg-transparent hover:border-red-400 transition-all duration-300 transform hover:scale-105 ml-4"
                            >
                              {resource.type && animalStates[resource.type]?.loading ? (
                                <RefreshCwIcon className="h-4 w-4 animate-spin mr-2" />
                              ) : null}
                              {resource.action}
                            </Button>
                          )}
                        </div>

                        {/* Ìò∏Ìù° Ïö¥Îèô Ïù∏ÎùºÏù∏ Î†åÎçîÎßÅ */}
                        {resource.type === "breath" && (
                          <div className="overflow-visible">
                            <BreathingExercise inline open={breathingOpen} onOpenChange={setBreathingOpen} />
                          </div>
                        )}

                        {/* ÎèôÎ¨º Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòÅÏó≠ */}
                        {resource.type &&
                          animalStates[resource.type]?.showImage &&
                          animalStates[resource.type]?.imageUrl && (
                            <div className="mt-4 text-center animate-fadeIn">
                              <div className="relative inline-block rounded-lg overflow-hidden shadow-lg">
                                <img
                                  src={animalStates[resource.type]?.imageUrl || "/placeholder.svg"}
                                  alt={resource.type === "cat" ? "Í∑ÄÏó¨Ïö¥ Í≥†ÏñëÏù¥" : "Í∑ÄÏó¨Ïö¥ Í∞ïÏïÑÏßÄ"}
                                  className="max-w-full max-h-[80vh] w-auto h-auto object-contain rounded-lg transition-all duration-500"
                                  crossOrigin="anonymous"
                                  onError={(e) => {
                                    e.currentTarget.src = `/placeholder.svg?height=300&width=400&text=${
                                      resource.type === "cat" ? "üê± Cute Cat" : "üê∂ Cute Dog"
                                    }`
                                  }}
                                />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/10 to-transparent rounded-lg pointer-events-none"></div>
                              </div>
                              <div className="mt-3 flex gap-2 justify-center">
                                <Button
                                  onClick={() =>
                                    resource.type === "cat"
                                      ? fetchCatImage(animalStates[resource.type]?.selectedApi || "cataas")
                                      : fetchDogImage(animalStates[resource.type]?.selectedApi || "dogceo")
                                  }
                                  disabled={animalStates[resource.type]?.loading || false}
                                  size="sm"
                                  className={`$${
                                    resource.type === "cat"
                                      ? "bg-gradient-to-r from-pink-400 to-rose-400 hover:from-pink-500 hover:to-rose-500"
                                      : "bg-gradient-to-r from-amber-400 to-orange-400 hover:from-amber-500 hover:to-orange-500"
                                  } text-white disabled:opacity-50`}
                                >
                                  {animalStates[resource.type]?.loading ? (
                                    <RefreshCwIcon className="h-4 w-4 animate-spin mr-2" />
                                  ) : null}
                                  ÏÉàÎ°úÏö¥ {resource.type === "cat" ? "Í≥†ÏñëÏù¥" : "Í∞ïÏïÑÏßÄ"} Î≥¥Í∏∞{" "}
                                  {resource.type === "cat" ? "üêæ" : "üêï"}
                                </Button>
                                <Button
                                  onClick={() =>
                                    setAnimalStates((prev) => ({
                                      ...prev,
                                      [resource.type || ""]: { ...prev[resource.type || ""], showImage: false },
                                    }))
                                  }
                                  size="sm"
                                  variant="outline"
                                  className="border-gray-300 text-gray-600 hover:bg-gray-50"
                                >
                                  Ïà®Í∏∞Í∏∞
                                </Button>
                              </div>
                            </div>
                          )}
                      </div>
                    ))}
                  </CardContent>
                </Card>
              </div>
            )}

            {/* ÎèÑÏõÄÎßê ÌÉ≠ */}
            {activeTab === "help" && (
              <div className="space-y-6 animate-fadeIn">
                <FAQSection />
              </div>
            )}
          </div>
        </Card>

        {/* ÌïòÎã® Î©îÏãúÏßÄ */}
        <Card className="shadow-lg backdrop-blur-sm bg-gradient-to-br from-red-100/80 via-rose-100/80 to-pink-100/80 dark:from-red-900/50 dark:via-rose-900/50 dark:to-pink-900/50 border-0">
          <CardContent className="p-6 text-center">
            <h3 className="text-lg font-semibold text-red-800 dark:text-red-200 mb-2">ÌòºÏûêÍ∞Ä ÏïÑÎãôÎãàÎã§</h3>
            <p className="text-red-700 dark:text-red-300 mb-4">
              Ïñ¥Î†§Ïö¥ ÏãúÍ∞ÑÏùÑ Î≥¥ÎÇ¥Í≥† Í≥ÑÏãúÏßÄÎßå, ÎèÑÏõÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Î∞©Î≤ïÏù¥ ÏûàÏäµÎãàÎã§. Ï†ÑÎ¨∏Í∞ÄÎì§Ïù¥ ÎãπÏã†ÏùÑ ÎèÑÏö∏ Ï§ÄÎπÑÍ∞Ä ÎêòÏñ¥
              ÏûàÏäµÎãàÎã§.
            </p>
            <Link href="/ai-chat">
              <Button className="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                <MessageSquareIcon className="mr-2 h-4 w-4" aria-hidden="true" />
                AIÏôÄ ÎåÄÌôîÌïòÍ∏∞
              </Button>
            </Link>
          </CardContent>
        </Card>

        {/* ÌïòÎã® Ïó¨Î∞± Ï∂îÍ∞Ä */}
        <div className="h-8"></div>
      </div>
    </div>
  )
}

export default EmergencyPage
